"0","#compositional data analysis across age"
"0","library(compositions)"
"0","library(factoextra)"
"0","library(data.table)"
"0","#data processing"
"0","library(tidyverse)"
"0","ref = read.csv(paste0(getwd(),'/unrestricted_bcaffo_12_12_2017_12_17_8.csv%3B.csv'), header = T)"
"0","colnames(ref)[1] = 'rawid'"
"0","#combine with patient info"
"0","dat_cor = list()"
"0","for(i in 1:4){"
"0","  dat_cor[[paste0('level',i)]] = left_join(dat[[paste0('level',i)]], ref[,c('rawid','Age','Gender')], by=""rawid"")"
"0","#across age"
"0","Age = as.character(unique(dat_cor$level1$Age))"
"0","Age = sort(Age[!is.na(Age)])"
"0","dat_age = list()"
"0","for (i in Age){"
"0","  a = dat_cor$level1 %>% filter(Age == i)"
"0","  dat_age[[i]] =  a[, !colnames(a) %in% c('rawid','Age','Gender')]"
"0","}"
"0","res.rotations = list()"
"0","for (i in names(dat_age)){"
"0","  #compositional data"
"0","  cdata = acomp(dat_age[[i]])"
"0","  #pca"
"0","  cdata.pca = prcomp(cdata,scale. = T)"
"0","  dat_visualization = prop.table(abs(cdata.pca$rotation),margin = 2) %>% melt()"
"0","  colnames(dat_visualization) = c('roi','Comp','value')"
"0","  "
"0","  res.rotations[[i]] = prop.table(abs(cdata.pca$rotation),margin = 2) %>% melt() %>% filter(Var2 == 'PC1')"
"0","  colnames(res.rotations[[i]]) = c('roi','PC','value')"
"0","  "
"0","print("
"0","  fviz_eig(cdata.pca)"
"0",")"
"0","  "
"0","print("
"0","  ggplot(dat_visualization, aes(x = as.factor(Comp), "
"0","                    y = value, "
"0","                    fill = as.factor(roi))"
"0","           ) + geom_col() +theme(legend.title = element_blank()) + labs(x = 'Comp', title = paste('compositional PCA across age',i))"
"0",")"
"0","}"
